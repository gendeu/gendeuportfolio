<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gen Deu Gagarin | UI/UX Portfolio</title>
  <meta name="description" content="Gen Deu Gagarin — UI/UX Developer & Frontend Engineer" />
  <style>
/* ===========================
   CSS (all styles inline)
   =========================== */
:root{--bg1:#0f2027;--bg2:#203a43;--bg3:#2c5364;--text:#f5f5f5;--accent:#00f2fe;--glass-bg:rgba(255,255,255,0.08);--glass-border:rgba(255,255,255,0.2)}
body.light{--bg1:#dbe6f6;--bg2:#cfd9df;--bg3:#e2ebf0;--text:#222;--accent:#3f51b5;--glass-bg:rgba(255,255,255,0.5);--glass-border:rgba(0,0,0,0.1)}
*{box-sizing:border-box}html,body{height:100%;margin:0;font-family:'Poppins',system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;color:var(--text);-webkit-font-smoothing:antialiased}
body{background:linear-gradient(-45deg,var(--bg1),var(--bg2),var(--bg3));background-size:400% 400%;animation:gradientMove 25s ease infinite;transition:background .8s ease,color .3s ease}
@keyframes gradientMove{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
#bgCanvas{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-2}
#progress-bar{position:fixed;top:0;left:0;height:3px;background:var(--accent);width:0;z-index:2000;transition:width .4s ease}
header{position:sticky;top:0;z-index:1000;backdrop-filter:blur(12px);padding:1rem 2rem}nav{display:flex;justify-content:space-between;align-items:center;gap:1rem}nav ul{list-style:none;display:flex;gap:1.5rem;margin:0;padding:0}nav ul li a{text-decoration:none;color:var(--text);position:relative}nav ul li a::after{content:"";position:absolute;left:0;bottom:-4px;width:100%;height:2px;background:var(--accent);transform:scaleX(0);transition:transform .3s ease;transform-origin:left}nav ul li a:hover::after{transform:scaleX(1)}#menu-toggle{display:none;cursor:pointer;font-size:1.5rem}
.page{display:none;opacity:0;transform:translateY(20px);transition:opacity .45s ease,transform .45s ease;min-height:80vh;padding:4rem 2rem}.page.active{display:block;opacity:1;transform:translateY(0)}
.hero{text-align:center;margin-top:15vh;padding:2rem}.highlight{color:var(--accent)}
.card.glass{padding:2rem;border-radius:20px;background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:blur(15px);margin:1.5rem auto;width:90%;max-width:1000px;text-align:center;transition:transform .25s ease,box-shadow .25s ease}.card.glass:hover{transform:translateY(-5px) scale(1.02);box-shadow:0 10px 20px rgba(0,0,0,.3)}
.btn{display:inline-block;margin-top:2rem;padding:.8rem 1.5rem;border-radius:30px;background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:blur(10px);color:var(--accent);font-weight:bold;text-decoration:none;transition:transform .2s ease,background .2s ease}.btn:hover{transform:scale(1.06);background:var(--accent);color:#111}
.project-grid{display:grid;gap:1.5rem;grid-template-columns:repeat(3,1fr)}@media (max-width:1024px){.project-grid{grid-template-columns:repeat(2,1fr)}}@media (max-width:720px){.project-grid{grid-template-columns:1fr}}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);justify-content:center;align-items:center;z-index:4000;opacity:0;transition:opacity .3s ease}.modal.show{opacity:1;display:flex}.modal-content{max-width:720px;padding:2rem;border-radius:20px;background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:blur(15px);transform:scale(.96);opacity:0;transition:transform .25s ease,opacity .25s ease;position:relative}.modal.show .modal-content{transform:scale(1);opacity:1}.close{position:absolute;top:15px;right:20px;font-size:1.6rem;cursor:pointer}
.skills-list{display:flex;flex-wrap:wrap;justify-content:center;gap:1rem}.chip{padding:.8rem 1.2rem;border-radius:30px;background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:blur(8px)}
footer{text-align:center;padding:2rem;color:rgba(255,255,255,.7)}
@media (max-width:768px){nav ul{display:none;flex-direction:column;gap:1rem;background:rgba(0,0,0,.85);padding:1rem;position:absolute;top:60px;right:20px;border-radius:12px}nav ul.show{display:flex;animation:slideIn .4s ease}@keyframes slideIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}#menu-toggle{display:block}.hero h2{font-size:1.8rem}.project-grid{grid-template-columns:1fr}}
.muted{color:rgba(255,255,255,.65);font-size:.95rem}

/* Projects header + view toggle */
.projects-header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
.view-toggle{display:flex;gap:8px}
.view-btn{width:40px;height:40px;border-radius:8px;border:1px solid rgba(255,255,255,.06);background:transparent;color:var(--text);cursor:pointer;font-size:18px;display:flex;align-items:center;justify-content:center}
.view-btn[aria-pressed="true"]{background:var(--accent);color:#071225;box-shadow:0 8px 18px rgba(0,0,0,.35);border-color:rgba(255,255,255,.08)}

/* ---------- CAROUSEL STYLES (CENTER-STAGE, NO VISIBLE SCROLLBAR) ---------- */
.carousel-view{display:flex;position:relative;align-items:center;gap:12px;margin:0 0 1.75rem 0}
.carousel-viewport{overflow:hidden;width:100%}
.carousel-track{
  display:flex;
  gap:18px;
  padding:22px 12px;
  overflow-x:auto;
  scroll-snap-type:x mandatory;
  scroll-behavior:smooth;
  -webkit-overflow-scrolling:touch;
  align-items:center;
  padding-left: calc(50% - 150px);
  padding-right: calc(50% - 150px);
}
.carousel-track::-webkit-scrollbar{height:0;display:none}
.carousel-track{ -ms-overflow-style: none; scrollbar-width: none; }

.carousel-item{
  min-width:300px;
  flex:0 0 300px;
  scroll-snap-align:center;
  display:flex;
  flex-direction:column;
  gap:10px;
  padding:12px;
  border-radius:14px;
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border:1px solid rgba(255,255,255,0.03);
  cursor:pointer;
  transform-origin:center center;
  transition: transform 180ms cubic-bezier(.18,.85,.32,1), box-shadow 180ms cubic-bezier(.18,.85,.32,1), z-index 180ms;
  will-change: transform, box-shadow;
  transform: translateY(0) scale(0.96);
  z-index: 1;
  opacity: 0.98;
}
.carousel-thumb{height:160px;border-radius:10px;background-size:cover;background-position:center;box-shadow:0 8px 30px rgba(0,0,0,.35)}

/* Active (center) item: larger & lifted */
.carousel-item.active{
  transform: translateY(-18px) scale(1.1);
  z-index: 30;
  box-shadow: 0 40px 100px rgba(2,6,23,0.72), 0 14px 44px rgba(0,0,0,0.44);
  opacity: 1;
}

/* neighbor styling */
.carousel-item.sibling{
  transform: translateY(-10px) scale(0.99);
  z-index: 10;
  box-shadow: 0 16px 36px rgba(0,0,0,0.32);
}

/* bigger arrows */
.carousel-nav{
  position:relative;
  z-index:40;
  border:none;
  background:rgba(0,0,0,0.55);
  color:var(--text);
  padding:16px 18px;
  border-radius:14px;
  cursor:pointer;
  min-width:72px;
  font-size:30px;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:transform .12s ease,background .15s ease;
}
.carousel-nav:hover{transform:scale(1.04);background:rgba(0,0,0,0.65)}
.carousel-prev{margin-right:12px}
.carousel-next{margin-left:12px}

/* Grid view */
.grid-view{display:block}
.grid-view.hidden{display:none}
.project-grid .project{padding:18px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.02);cursor:pointer;transition:transform .2s ease}
.project-grid .project:hover{transform:translateY(-6px)}

/* responsive tweaks */
@media (max-width:900px){
  .carousel-item{min-width:220px;flex:0 0 220px}
  .carousel-thumb{height:120px}
  .carousel-track{padding-left: calc(50% - 110px); padding-right: calc(50% - 110px);}
  .carousel-nav{min-width:48px;padding:10px 12px;font-size:22px}
}
@media (max-width:520px){
  header{padding:0.7rem 1rem}
  .hero{margin-top:8vh}
}
  
/* Loader styles (floating GD circle) */
#loader{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);z-index:6000;pointer-events:none;opacity:0;transition:opacity .28s ease}
.loader-logo{width:84px;height:84px;border-radius:50%;background:var(--glass-bg);border:2px solid var(--glass-border);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--accent);font-size:1.15rem;backdrop-filter:blur(8px);box-shadow:0 8px 30px rgba(0,0,0,0.35);transition:transform .28s ease,box-shadow .28s ease}
.loader-logo span{user-select:none}
#dim{position:fixed;inset:0;background:rgba(0,0,0,0.28);z-index:5900;opacity:0;pointer-events:none;transition:opacity .28s ease}
.loader-visible{opacity:1}
  </style>
</head>
<body>
  <!-- Loader (floating) -->
  <div id="loader" aria-hidden="true"><div class="loader-logo"><span>GD</span></div></div>
  <div id="dim" aria-hidden="true"></div>

  <!-- Particle Background -->
  <canvas id="bgCanvas"></canvas>

  <!-- Progress bar (kept but unused mainly) -->
  <div id="progress-bar" aria-hidden="true"></div>

  <!-- Navbar -->
  <header>
    <nav>
      <h1 class="logo">GenDeu</h1>
      <div id="menu-toggle">☰</div>
      <ul>
        <li><a href="#home" class="nav-link active">Home</a></li>
        <li><a href="#about" class="nav-link">About</a></li>
        <li><a href="#projects" class="nav-link">Projects</a></li>
        <li><a href="#skills" class="nav-link">Skills</a></li>
        <li><a href="#contact" class="nav-link">Contact</a></li>
      </ul>
      <button id="theme-toggle">🌙</button>
    </nav>
  </header>

  <!-- Hero -->
  <section id="home" class="page active">
    <div class="hero">
      <h2>Hello, I’m <span class="highlight">Gen Deu</span></h2>
      <p class="tagline"><span id="typewriter"></span></p>
      <a href="#projects" class="btn nav-link">See My Work</a>
    </div>
  </section>

  <!-- About -->
  <section id="about" class="page">
    <h2>About Me</h2>
    <div class="card glass fade-in">
      <p>I’m a UI/UX Developer and Frontend Engineer passionate about creating sleek, user-focused web experiences. I bridge design and code, ensuring beautiful interfaces deliver smooth, intuitive interactions.</p>
    </div>
  </section>

  <!-- Projects -->
  <section id="projects" class="page">
    <div class="projects-header">
      <h2>Case Studies</h2>

      <!-- View toggle -->
      <div class="view-toggle" role="tablist" aria-label="Projects view toggle">
        <button id="btn-carousel" class="view-btn" aria-pressed="true" title="Carousel view">🎮</button>
        <button id="btn-grid" class="view-btn" aria-pressed="false" title="Grid view">▦</button>
      </div>
    </div>

    <!-- CAROUSEL VIEW -->
    <div id="carouselView" class="carousel-view active" aria-hidden="false">
      <button class="carousel-nav carousel-prev" aria-label="Previous">‹</button>

      <div class="carousel-viewport">
        <div class="carousel-track" tabindex="0" role="listbox" aria-label="Project carousel">
          <!-- carousel items -->
          <div class="card glass carousel-item" data-key="klp" role="option" aria-label="KLP Lifestyle">
            <div class="carousel-thumb" style="background-image:url('assets/klp.jpg')"></div>
            <h3>KLP Lifestyle</h3>
            <p class="muted">E-commerce redesign</p>
          </div>

          <div class="card glass carousel-item" data-key="fixifoot" role="option" aria-label="Fixifoot">
            <div class="carousel-thumb" style="background-image:url('assets/fixifoot.jpg')"></div>
            <h3>Fixifoot</h3>
            <p class="muted">Product showcase</p>
          </div>

          <div class="card glass carousel-item" data-key="cveez" role="option" aria-label="Cveez">
            <div class="carousel-thumb" style="background-image:url('assets/cveez.jpg')"></div>
            <h3>Cveez</h3>
            <p class="muted">Service booking platform</p>
          </div>

          <div class="card glass carousel-item" data-key="other1" role="option" aria-label="Other Project 1">
            <div class="carousel-thumb" style="background-image:url('assets/other1.jpg')"></div>
            <h3>Other 1</h3>
            <p class="muted">UI components</p>
          </div>

          <div class="card glass carousel-item" data-key="other2" role="option" aria-label="Other Project 2">
            <div class="carousel-thumb" style="background-image:url('assets/other2.jpg')"></div>
            <h3>Other 2</h3>
            <p class="muted">Landing page</p>
          </div>

        </div>
      </div>

      <button class="carousel-nav carousel-next" aria-label="Next">›</button>
    </div>

    <!-- GRID / CARD LIST VIEW -->
    <div id="gridView" class="grid-view hidden">
      <div class="project-grid">
        <div class="card glass project" data-key="klp" onclick="openCaseStudy('klp')">
          <h3>KLP Lifestyle</h3><p>E-commerce redesign</p>
        </div>
        <div class="card glass project" data-key="fixifoot" onclick="openCaseStudy('fixifoot')">
          <h3>Fixifoot</h3><p>Product showcase</p>
        </div>
        <div class="card glass project" data-key="cveez" onclick="openCaseStudy('cveez')">
          <h3>Cveez</h3><p>Service booking platform</p>
        </div>
        <div class="card glass project" data-key="other1" onclick="openCaseStudy('other1')">
          <h3>Other 1</h3><p>UI components</p>
        </div>
        <div class="card glass project" data-key="other2" onclick="openCaseStudy('other2')">
          <h3>Other 2</h3><p>Landing page</p>
        </div>
      </div>
    </div>

  </section>

  <!-- Case Study Modal -->
  <div id="case-study" class="modal" aria-hidden="true">
    <div class="modal-content glass" role="dialog" aria-modal="true">
      <span class="close" title="Close modal">&times;</span>
      <h3 id="case-title"></h3>
      <p id="case-problem"></p>
      <p id="case-process"></p>
      <p id="case-solution"></p>
      <a id="case-link" href="#" target="_blank" class="btn">View Live</a>
    </div>
  </div>

  <!-- Skills -->
  <section id="skills" class="page">
    <h2>Skills</h2>
    <div class="skills-list fade-in">
      <span class="chip">HTML5</span>
      <span class="chip">CSS3</span>
      <span class="chip">JavaScript</span>
      <span class="chip">React</span>
      <span class="chip">Figma</span>
      <span class="chip">UI/UX Design</span>
    </div>
  </section>

  <!-- Contact -->
  <section id="contact" class="page">
    <h2>Contact</h2>
    <div class="card glass fade-in">
      <p>Email: <a href="mailto:gendeulgagarin@gmail.com">gendeulgagarin@gmail.com</a></p>
      <p>LinkedIn: <a href="https://linkedin.com/in/gen-deu-gagarin-952781165" target="_blank">linkedin.com/in/gen-deu-gagarin</a></p>
      <p>GitHub: <a href="https://github.com/gendeu" target="_blank">github.com/gendeu</a></p>
    </div>
  </section>

  <footer>
    <p>© 2025 Gen Deu Gagarin | Designed with ❤️</p>
  </footer>

<script>
/* ============================
   Full JS (inline)
   ============================ */

/* Helper query selectors used across script */
const links = document.querySelectorAll('.nav-link');
const pages = document.querySelectorAll('.page');
const loaderEl = document.getElementById('loader');
const dimEl = document.getElementById('dim');
const progressBar = document.getElementById('progress-bar');
const btnCarousel = document.getElementById('btn-carousel');
const btnGrid = document.getElementById('btn-grid');
const carouselView = document.getElementById('carouselView');
const gridView = document.getElementById('gridView');
const carouselTrack = document.querySelector('.carousel-track');
const prevBtn = document.querySelector('.carousel-prev');
const nextBtn = document.querySelector('.carousel-next');

/* ============================
   Floating GD Loader (pointer-follow)
   - restored working version
   ============================ */
let pointer = { x: window.innerWidth / 2, y: window.innerHeight / 2 };
let pos = { x: pointer.x, y: pointer.y };
let rafId = null;
const followEase = 0.16;
const loaderMargin = 28;

function onPointerMove(e) {
  const ev = (e.touches && e.touches[0]) ? e.touches[0] : e;
  pointer.x = ev.clientX;
  pointer.y = ev.clientY;
}
window.addEventListener('mousemove', onPointerMove, { passive: true });
window.addEventListener('touchmove', onPointerMove, { passive: true });

function animateLoader() {
  pos.x += (pointer.x - pos.x) * followEase;
  pos.y += (pointer.y - pos.y) * followEase;
  const vw = window.innerWidth, vh = window.innerHeight;
  const x = Math.min(Math.max(pos.x, loaderMargin), vw - loaderMargin);
  const y = Math.min(Math.max(pos.y, loaderMargin), vh - loaderMargin);
  if (loaderEl) {
    loaderEl.style.left = x + 'px';
    loaderEl.style.top = y + 'px';
  }
  rafId = requestAnimationFrame(animateLoader);
}

function showLoader() {
  if (!rafId) animateLoader();
  if (loaderEl) {
    loaderEl.classList.add('loader-visible');
    loaderEl.style.opacity = '1';
  }
  if (dimEl) dimEl.style.opacity = '1';
}
function hideLoader() {
  if (loaderEl) loaderEl.style.opacity = '0';
  if (dimEl) dimEl.style.opacity = '0';
  if (loaderEl) loaderEl.classList.remove('loader-visible');
  setTimeout(() => { if (rafId) { cancelAnimationFrame(rafId); rafId = null; } }, 320);
}

// center pointer when idle so loader drifts to center
let pointerTimer = null;
function ensureCenterOnIdle() {
  clearTimeout(pointerTimer);
  pointerTimer = setTimeout(() => {
    pointer.x = window.innerWidth / 2;
    pointer.y = window.innerHeight / 2;
  }, 2200);
}
window.addEventListener('mousemove', ensureCenterOnIdle, { passive: true });
window.addEventListener('touchmove', ensureCenterOnIdle, { passive: true });

/* expose show/hide for manual use (nav) */
window.showLoader = showLoader;
window.hideLoader = hideLoader;

/* ============================
   Particle background
   ============================ */
const canvas = document.getElementById("bgCanvas");
const ctx = canvas.getContext && canvas.getContext("2d");
function fitCanvas(){ if(!canvas) return; canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
fitCanvas();
let particles = [];
if (ctx) {
  for (let i=0;i<90;i++){
    particles.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,radius:1+Math.random()*2,dx:(Math.random()-.5)*.7,dy:(Math.random()-.5)*.7,opacity:Math.random(),twinkleSpeed:Math.random()*.02+.005});
  }
  function animateParticles(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    particles.forEach(p=>{
      ctx.beginPath();
      if (!document.body.classList.contains("light")){ p.opacity += p.twinkleSpeed * (Math.random()>0.5?1:-1); if(p.opacity>1)p.opacity=1; if(p.opacity<0.18)p.opacity=0.18; } else { p.opacity=0.35; }
      ctx.fillStyle=`rgba(255,255,255,${p.opacity})`;
      ctx.arc(p.x,p.y,p.radius,0,Math.PI*2); ctx.fill();
      p.x+=p.dx; p.y+=p.dy;
      if(p.x<0||p.x>canvas.width)p.dx*=-1;
      if(p.y<0||p.y>canvas.height)p.dy*=-1;
    });
    requestAnimationFrame(animateParticles);
  }
  animateParticles();
  window.addEventListener("resize", fitCanvas);
}

/* ============================
   SPA Navigation (kept)
   ============================ */
document.addEventListener("DOMContentLoaded", () => {
  // show loader for a brief moment on first load
  showLoader();
  setTimeout(() => hideLoader(), 1200);
});
links.forEach(link => {
  link.addEventListener('click', e => {
    e.preventDefault();
    const targetId = link.getAttribute('href');
    showLoader();
    links.forEach(l => l.classList.remove('active'));
    link.classList.add('active');
    pages.forEach(p => {
      if (p.classList.contains('active')) {
        p.style.opacity = "0"; p.style.transform = "translateY(20px)";
        setTimeout(() => p.classList.remove('active'), 360);
      }
    });
    setTimeout(() => {
      const targetPage = document.querySelector(targetId);
      targetPage.classList.add('active');
      targetPage.style.opacity = "1";
      targetPage.style.transform = "translateY(0)";
      hideLoader();
    }, 900 + Math.random()*700);
  });
});
const menuToggle = document.getElementById("menu-toggle");
const navMenu = document.querySelector("nav ul");
if (menuToggle) menuToggle.addEventListener("click", () => navMenu.classList.toggle("show"));

/* ============================
   Typewriter
   ============================ */
const roles = ["UI/UX Developer", "Frontend Engineer", "Creative Coder"];
let roleIndex = 0, charIndex = 0;
const typewriter = document.getElementById("typewriter");
function type() {
  if (!typewriter) return;
  if (charIndex < roles[roleIndex].length) {
    typewriter.textContent += roles[roleIndex].charAt(charIndex++);
    setTimeout(type, 90);
  } else setTimeout(erase, 1800);
}
function erase() {
  if (!typewriter) return;
  if (charIndex > 0) {
    typewriter.textContent = roles[roleIndex].substring(0, --charIndex);
    setTimeout(erase, 40);
  } else {
    roleIndex = (roleIndex + 1) % roles.length;
    setTimeout(type, 400);
  }
}
type();

/* ============================
   Case studies modal
   ============================ */
const caseStudies = {
  klp:{title:"KLP Lifestyle",problem:"E-commerce lacked responsive UI.",process:"Figma redesign + frontend build.",solution:"Delivered clean, mobile UI.",link:"https://klplifestyle.com/"},
  fixifoot:{title:"Fixifoot",problem:"Showcase not engaging.",process:"Interactive grids + responsive design.",solution:"Better UX & conversions.",link:"https://fixifoot.ph/"},
  cveez:{title:"Cveez",problem:"Needed sleek booking UX.",process:"Designed flows + coded frontend.",solution:"Modern booking platform.",link:"https://cveez.com/"},
  other1:{title:"Other 1",problem:"Reusable UI components.",process:"Component library.",solution:"Faster builds.",link:"#"},
  other2:{title:"Other 2",problem:"Landing optimization.",process:"A/B test + frontend.",solution:"Higher conversions.",link:"#"}
};
const modal = document.getElementById("case-study");
const closeBtn = modal.querySelector(".close");
function openCaseStudy(key) {
  const d = caseStudies[key]; if (!d) return;
  document.getElementById("case-title").textContent = d.title;
  document.getElementById("case-problem").textContent = "Problem: " + d.problem;
  document.getElementById("case-process").textContent = "Process: " + d.process;
  document.getElementById("case-solution").textContent = "Solution: " + d.solution;
  document.getElementById("case-link").href = d.link;
  modal.style.display = "flex";
  setTimeout(() => modal.classList.add("show"), 18);
}
function closeCaseStudy() {
  modal.classList.remove('show');
  setTimeout(() => { modal.style.display = "none"; }, 260);
}
closeBtn.addEventListener("click", closeCaseStudy);
window.addEventListener("click", e => { if (e.target === modal) closeCaseStudy(); });
window.addEventListener("keydown", e => { if (e.key === "Escape") closeCaseStudy(); });

/* ============================
   View toggle (carousel / grid)
   ============================ */
function setProjectsView(mode) {
  if (mode === 'grid') {
    carouselView.classList.remove('active');
    gridView.classList.remove('hidden');
    btnCarousel.setAttribute('aria-pressed', 'false');
    btnGrid.setAttribute('aria-pressed', 'true');
    localStorage.setItem('projectsView', 'grid');
  } else {
    carouselView.classList.add('active');
    gridView.classList.remove('hidden'); // keep grid hidden by default visually - we'll toggle class properly
    gridView.classList.add('hidden');    // ensure hidden
    gridView.classList.remove('hidden'); // force DOM repaint guard (safe)
    gridView.classList.add('hidden');    // final state preserved
    gridView.classList.remove('hidden'); // just avoid layout jumps
    gridView.classList.add('hidden');
    carouselView.classList.add('active');
    gridView.classList.add('hidden');
    btnCarousel.setAttribute('aria-pressed', 'true');
    btnGrid.setAttribute('aria-pressed', 'false');
    localStorage.setItem('projectsView', 'carousel');
  }
}
const savedView = localStorage.getItem('projectsView') || 'carousel';
setProjectsView(savedView);
if (btnCarousel) btnCarousel.addEventListener('click', () => setProjectsView('carousel'));
if (btnGrid) btnGrid.addEventListener('click', () => setProjectsView('grid'));

/* ============================
   CENTER-STAGE CAROUSEL (hidden scrollbar + drag)
   ============================ */
const carouselItems = carouselTrack ? Array.from(carouselTrack.querySelectorAll('.carousel-item')) : [];

if (carouselTrack && carouselItems.length) {

  function centerItem(item, smooth = true) {
    const trackRect = carouselTrack.getBoundingClientRect();
    const itemRect = item.getBoundingClientRect();
    const trackScrollLeft = carouselTrack.scrollLeft;
    const itemCenter = (itemRect.left - trackRect.left) + (itemRect.width / 2);
    const targetScroll = trackScrollLeft + itemCenter - (trackRect.width / 2);
    carouselTrack.scrollTo({ left: targetScroll, behavior: smooth ? 'smooth' : 'auto' });
  }

  function findCenteredItem() {
    const trackRect = carouselTrack.getBoundingClientRect();
    const trackCenterX = trackRect.left + trackRect.width / 2;
    let minDist = Infinity, closest = null;
    carouselItems.forEach(it => {
      const r = it.getBoundingClientRect();
      const itemCenter = r.left + r.width / 2;
      const dist = Math.abs(itemCenter - trackCenterX);
      if (dist < minDist) { minDist = dist; closest = it; }
    });
    return closest;
  }

  function updateActiveClasses() {
    const active = findCenteredItem();
    if (!active) return;
    carouselItems.forEach(it => {
      it.classList.remove('active', 'sibling');
      it.setAttribute('aria-selected', 'false');
    });
    active.classList.add('active');
    active.setAttribute('aria-selected', 'true');
    const idx = carouselItems.indexOf(active);
    if (idx > 0) carouselItems[idx - 1].classList.add('sibling');
    if (idx < carouselItems.length - 1) carouselItems[idx + 1].classList.add('sibling');
  }

  // RAF throttle scroll
  let ticking = false;
  carouselTrack.addEventListener('scroll', () => {
    if (!ticking) {
      window.requestAnimationFrame(() => {
        updateActiveClasses();
        ticking = false;
      });
      ticking = true;
    }
  }, { passive: true });

  // Initial centering: ALWAYS choose the middle index by default
  window.addEventListener('load', () => {
    const middleIndex = Math.floor(carouselItems.length / 2);
    const startItem = carouselItems[middleIndex] || carouselItems[0];
    centerItem(startItem, false);
    setTimeout(updateActiveClasses, 40);
    // store default center if you need
    localStorage.setItem('carouselCenterIndex', middleIndex);
  });

  // CLICK behavior:
  // - Mobile/touch (< 900px): tapping any card immediately opens modal
  // - Desktop: tapping inactive card centers it; tapping currently active card opens modal
  carouselItems.forEach((it, i) => {
    it.addEventListener('click', (e) => {
      const viewportWidth = window.innerWidth;
      const isMobile = viewportWidth < 900; // threshold
      const isActive = it.classList.contains('active');

      if (isMobile) {
        const key = it.dataset.key;
        if (key) openCaseStudy(key);
        return;
      }

      if (!isActive) {
        centerItem(it, true);
        setTimeout(() => {
          updateActiveClasses();
          localStorage.setItem('carouselCenterIndex', i);
        }, 260);
      } else {
        const key = it.dataset.key;
        if (key) openCaseStudy(key);
      }
    });
  });

  // Prev / Next
  if (prevBtn) prevBtn.addEventListener('click', () => {
    const active = findCenteredItem(); if (!active) return;
    const idx = carouselItems.indexOf(active);
    const targetIndex = Math.max(0, idx - 1);
    const target = carouselItems[targetIndex];
    centerItem(target, true);
    localStorage.setItem('carouselCenterIndex', targetIndex);
    setTimeout(updateActiveClasses, 180);
  });
  if (nextBtn) nextBtn.addEventListener('click', () => {
    const active = findCenteredItem(); if (!active) return;
    const idx = carouselItems.indexOf(active);
    const targetIndex = Math.min(carouselItems.length - 1, idx + 1);
    const target = carouselItems[targetIndex];
    centerItem(target, true);
    localStorage.setItem('carouselCenterIndex', targetIndex);
    setTimeout(updateActiveClasses, 180);
  });

  // Keyboard
  carouselTrack.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowRight') { nextBtn && nextBtn.click(); }
    if (e.key === 'ArrowLeft') { prevBtn && prevBtn.click(); }
  });

  // Snap to nearest item when user stops scrolling
  let scrollEndTimer = null;
  carouselTrack.addEventListener('scroll', () => {
    clearTimeout(scrollEndTimer);
    scrollEndTimer = setTimeout(() => {
      const center = findCenteredItem();
      if (center) {
        centerItem(center, true);
        updateActiveClasses();
        const idx = carouselItems.indexOf(center);
        localStorage.setItem('carouselCenterIndex', idx);
      }
    }, 80);
  }, { passive: true });

  // Resize re-center
  window.addEventListener('resize', () => {
    const active = findCenteredItem() || carouselItems[Math.floor(carouselItems.length/2)] || carouselItems[0];
    centerItem(active, false);
    setTimeout(updateActiveClasses, 60);
  });

  /* Drag-to-scroll (pointer events) so scrollbar can be hidden */
  let isDown = false, startX = 0, startScroll = 0;
  carouselTrack.addEventListener('pointerdown', (e) => {
    isDown = true;
    carouselTrack.setPointerCapture(e.pointerId);
    startX = e.clientX;
    startScroll = carouselTrack.scrollLeft;
    carouselTrack.style.cursor = 'grabbing';
  });
  carouselTrack.addEventListener('pointermove', (e) => {
    if (!isDown) return;
    e.preventDefault();
    const dx = e.clientX - startX;
    carouselTrack.scrollLeft = startScroll - dx;
  }, { passive: false });
  const endDrag = (e) => {
    if (!isDown) return;
    isDown = false;
    try { carouselTrack.releasePointerCapture(e && e.pointerId); } catch {}
    carouselTrack.style.cursor = 'grab';
    const center = findCenteredItem();
    if (center) centerItem(center, true);
  };
  carouselTrack.addEventListener('pointerup', endDrag);
  carouselTrack.addEventListener('pointercancel', endDrag);
  carouselTrack.addEventListener('pointerleave', endDrag);
  carouselTrack.style.cursor = 'grab';
}

/* ============================
   Theme toggle
   ============================ */
const toggleBtn = document.getElementById("theme-toggle");
if (toggleBtn) toggleBtn.addEventListener("click", () => {
  document.body.classList.toggle("light");
  toggleBtn.textContent = document.body.classList.contains("light") ? "🌞" : "🌙";
});

/* ============================
   End of script
   ============================ */
</script>
</body>
</html>
