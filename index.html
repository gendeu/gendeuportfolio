<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gen Deu Gagarin | UI/UX Portfolio</title>
  <meta name="description" content="Gen Deu Gagarin — UI/UX Developer & Frontend Engineer" />
  <style>
/* ---------- Base + Theme ---------- */
:root{--bg1:#0f2027;--bg2:#203a43;--bg3:#2c5364;--text:#f5f5f5;--accent:#00f2fe;--glass-bg:rgba(255,255,255,0.08);--glass-border:rgba(255,255,255,0.2)}
body.light{--bg1:#dbe6f6;--bg2:#cfd9df;--bg3:#e2ebf0;--text:#222;--accent:#3f51b5;--glass-bg:rgba(255,255,255,0.5);--glass-border:rgba(0,0,0,0.1)}
*{box-sizing:border-box}html,body{height:100%;margin:0;font-family:'Poppins',system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;color:var(--text);-webkit-font-smoothing:antialiased}
body{background:linear-gradient(-45deg,var(--bg1),var(--bg2),var(--bg3));background-size:400% 400%;animation:gradientMove 25s ease infinite;transition:background .8s ease,color .3s ease}
@keyframes gradientMove{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
a{color:var(--accent);text-decoration:none}

/* ---------- Layout ---------- */
header{position:sticky;top:0;z-index:1000;backdrop-filter:blur(12px);padding:1rem 2rem}
nav{display:flex;justify-content:space-between;align-items:center;gap:1rem}nav ul{list-style:none;display:flex;gap:1.5rem;margin:0;padding:0}nav ul li a{text-decoration:none;color:var(--text);position:relative}nav ul li a::after{content:"";position:absolute;left:0;bottom:-4px;width:100%;height:2px;background:var(--accent);transform:scaleX(0);transition:transform .3s ease;transform-origin:left}nav ul li a:hover::after{transform:scaleX(1)}#menu-toggle{display:none;cursor:pointer;font-size:1.5rem}
.page{display:none;opacity:0;transform:translateY(20px);transition:opacity .45s ease,transform .45s ease;min-height:80vh;padding:3.5rem 2rem}.page.active{display:block;opacity:1;transform:translateY(0)}
.hero{text-align:center;margin-top:12vh;padding:2rem}.highlight{color:var(--accent)}
.card.glass{padding:2rem;border-radius:20px;background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:blur(15px);margin:1.5rem auto;width:90%;max-width:1000px;text-align:center;transition:transform .25s ease,box-shadow .25s ease}
.btn{display:inline-block;margin-top:1rem;padding:.6rem 1.2rem;border-radius:30px;background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:blur(10px);color:var(--accent);font-weight:bold;text-decoration:none;transition:transform .2s ease,background .2s ease}
.btn:hover{transform:scale(1.04)}
.muted{color:rgba(255,255,255,.7);font-size:.95rem}

/* Projects header + view toggle */
.projects-header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
.view-toggle{display:flex;gap:8px}
.view-btn{width:40px;height:40px;border-radius:8px;border:1px solid rgba(255,255,255,.06);background:transparent;color:var(--text);cursor:pointer;font-size:18px;display:flex;align-items:center;justify-content:center}
.view-btn[aria-pressed="true"]{background:var(--accent);color:#071225;box-shadow:0 8px 18px rgba(0,0,0,.35);border-color:rgba(255,255,255,.08)}

/* Grid view */
.project-grid{display:grid;gap:1.25rem;grid-template-columns:repeat(3,1fr)}@media (max-width:1024px){.project-grid{grid-template-columns:repeat(2,1fr)}}@media (max-width:720px){.project-grid{grid-template-columns:1fr}}
.project-grid .project{padding:18px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.02);cursor:pointer;transition:transform .2s ease}
.project-grid .project:hover{transform:translateY(-6px)}

/* ---------- USER'S ORIGINAL CAROUSEL (CSS) ---------- */
.custom-carousel{
  position:relative;
  max-width:1000px;
  margin:0 auto;
  display:flex;
  align-items:center;
  justify-content:center;
}

.carousel-track-container{
  width:100%;
  min-height:303px;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
  position:relative;
}

.carousel-track{
  display:flex;
  transition:transform .5s ease;
  will-change:transform;
  position: absolute;
  left: -80px;
}

.carousel-slide{
  flex:0 0 auto;
  width:190px;
  max-height: 240px;
  margin:0 10px;
  background:#fff;
  overflow:hidden;
  text-align:center;
  opacity:.5;
  transition:all .3s ease;
  display:flex;
  flex-direction:column;
  cursor:pointer;
  border: 3px gray solid;
}

.carousel-slide img{
  width:100%;
  object-fit:cover;
}

.carousel-slide p{
    background: #f5f5f5;
    margin: 0;
    height: 90px;
    padding: 10px;
    font-size: 14px;
    font-weight: 600;
    color: #333;
    align-items: center;
    text-align: center;
    justify-content: center;
    display: flex;
}

.carousel-slide p.hidden { display:none; }
.carousel-slide.no-title img { height:100%; object-fit:scale-down; }
.carousel-slide.no-title { flex-direction:row; }

.carousel-slide.active{
  transform: scale(1.2);
  opacity:1;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
  z-index:2;
  margin: 0 7px;
}

/* Arrow buttons */
.arrow-btn {
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  background:#fff;
  border:none;
  width:44px;
  height:44px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  box-shadow:rgba(0,0,0,0.19) 0px 6px 8px;
  z-index:3;
  transition:background 0.2s ease;
}

.arrow-btn svg { width:36px; height:36px; fill:#333; }
.arrow-btn:hover { background:#f0f0f0; }
.arrow-btn.prev { left:6px; }
.arrow-btn.next { right:6px; }
.arrow-btn:disabled { opacity:.3; cursor:not-allowed; }

.carousel-description{
  max-width:800px;
  margin:20px auto 0;
  padding:15px;
  font-size:16px;
  color:#444;
  line-height:1.4;
  text-align:center;
}
.carousel-description.hidden { display:none; }

/* Modal */
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);justify-content:center;align-items:center;z-index:6000;opacity:0;transition:opacity .25s ease}.modal.show{display:flex;opacity:1}
.modal-content{max-width:720px;padding:2rem;border-radius:20px;background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:blur(15px);transform:translateY(0);opacity:1;position:relative}
.close{position:absolute;top:12px;right:16px;font-size:1.4rem;cursor:pointer}

/* Loader + Particles */
#loader{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);z-index:7000;pointer-events:none;opacity:0;transition:opacity .28s ease}
.loader-logo{width:84px;height:84px;border-radius:50%;background:var(--glass-bg);border:2px solid var(--glass-border);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--accent);font-size:1.15rem;backdrop-filter:blur(8px);box-shadow:0 8px 30px rgba(0,0,0,0.35);transition:transform .28s ease,box-shadow .28s ease}
#dim{position:fixed;inset:0;background:rgba(0,0,0,0.28);z-index:6900;opacity:0;pointer-events:none;transition:opacity .28s ease}
.loader-visible{opacity:1}

/* Responsive */
@media (max-width:768px){nav ul{display:none}#menu-toggle{display:block} .project-grid{grid-template-columns:1fr}}
@media (max-width:560px){ .carousel-slide{ width:150px } }

  </style>
</head>
<body>

  <!-- Loader (floating) -->
  <div id="loader" aria-hidden="true"><div class="loader-logo"><span>GD</span></div></div>
  <div id="dim" aria-hidden="true"></div>

  <!-- Particle Background -->
  <canvas id="bgCanvas"></canvas>

  <!-- Navbar -->
  <header>
    <nav>
      <h1 class="logo">GenDeu</h1>
      <div id="menu-toggle">☰</div>
      <ul>
        <li><a href="#home" class="nav-link active">Home</a></li>
        <li><a href="#about" class="nav-link">About</a></li>
        <li><a href="#projects" class="nav-link">Projects</a></li>
        <li><a href="#skills" class="nav-link">Skills</a></li>
        <li><a href="#contact" class="nav-link">Contact</a></li>
      </ul>
      <button id="theme-toggle">🌙</button>
    </nav>
  </header>

  <!-- Hero -->
  <section id="home" class="page active">
    <div class="hero">
      <h2>Hello, I’m <span class="highlight">Gen Deu</span></h2>
      <p class="tagline"><span id="typewriter"></span></p>
      <a href="#projects" class="btn nav-link">See My Work</a>
    </div>
  </section>

  <!-- About -->
  <section id="about" class="page">
    <h2>About Me</h2>
    <div class="card glass fade-in">
      <p>I’m a UI/UX Developer and Frontend Engineer passionate about creating sleek, user-focused web experiences.</p>
    </div>
  </section>

  <!-- Projects -->
  <section id="projects" class="page">
    <div class="projects-header">
      <h2>Case Studies</h2>
      <div class="view-toggle" role="tablist" aria-label="Projects view toggle">
        <button id="btn-carousel" class="view-btn" aria-pressed="true" title="Carousel view">🎮</button>
        <button id="btn-grid" class="view-btn" aria-pressed="false" title="Grid view">▦</button>
      </div>
    </div>

    <!-- USER'S ORIGINAL CAROUSEL MARKUP -->
    <div id="carouselView" class="custom-carousel" aria-hidden="false">
      <button class="arrow-btn prev" tabindex="0" aria-label="Previous">
        <svg viewBox="0 0 256 512" aria-hidden="true">
          <path d="M31.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L127.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L201.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34z"></path>
        </svg>
      </button>

      <div class="carousel-track-container">
        <div class="carousel-track"><!-- slides will be injected here --></div>
      </div>

      <button class="arrow-btn next" tabindex="0" aria-label="Next">
        <svg viewBox="0 0 256 512" aria-hidden="true">
          <path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9L128.1 256 31.7 159.6c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"></path>
        </svg>
      </button>
    </div>

    <!-- Description -->
    <div class="carousel-description"></div>

    <!-- GRID / CARD LIST VIEW -->
    <div id="gridView" class="project-grid" style="display:none;">
      <div class="card glass project" data-key="klp"><h3>KLP Lifestyle</h3><p>E-commerce redesign</p></div>
      <div class="card glass project" data-key="fixifoot"><h3>Fixifoot</h3><p>Product showcase</p></div>
      <div class="card glass project" data-key="cveez"><h3>Cveez</h3><p>Service booking platform</p></div>
      <div class="card glass project" data-key="other1"><h3>Other 1</h3><p>UI components</p></div>
      <div class="card glass project" data-key="other2"><h3>Other 2</h3><p>Landing page</p></div>
    </div>

  </section>

  <!-- Case Study Modal (re-usable) -->
  <div id="case-study" class="modal" aria-hidden="true">
    <div class="modal-content glass" role="dialog" aria-modal="true">
      <span class="close" title="Close modal">&times;</span>
      <h3 id="case-title"></h3>
      <p id="case-problem"></p>
      <p id="case-process"></p>
      <p id="case-solution"></p>
      <a id="case-link" href="#" target="_blank" class="btn">View Live</a>
    </div>
  </div>

  <!-- Skills -->
  <section id="skills" class="page">
    <h2>Skills</h2>
    <div class="card glass fade-in">
      <p>HTML5 · CSS3 · JavaScript · React · Figma · UI/UX</p>
    </div>
  </section>

  <!-- Contact -->
  <section id="contact" class="page">
    <h2>Contact</h2>
    <div class="card glass fade-in">
      <p>Email: <a href="mailto:gendeulgagarin@gmail.com">gendeulgagarin@gmail.com</a></p>
    </div>
  </section>

  <footer style="text-align:center;padding:2rem;color:rgba(255,255,255,.7)">© 2025 Gen Deu Gagarin | Designed with ❤️</footer>

<script>
/* -------------------------
   App JS: SPA + Loader + Particles + Typewriter + Theme
   ------------------------- */
const links = document.querySelectorAll('.nav-link');
const pages = document.querySelectorAll('.page');
const loaderEl = document.getElementById('loader');
const dimEl = document.getElementById('dim');
const btnCarousel = document.getElementById('btn-carousel');
const btnGrid = document.getElementById('btn-grid');
const carouselView = document.getElementById('carouselView');
const gridView = document.getElementById('gridView');
const caseModal = document.getElementById('case-study');
const closeBtn = caseModal.querySelector('.close');

function showLoader(){ loaderEl && (loaderEl.style.opacity = '1'); dimEl && (dimEl.style.opacity = '1'); }
function hideLoader(){ loaderEl && (loaderEl.style.opacity = '0'); dimEl && (dimEl.style.opacity = '0'); }

const canvas = document.getElementById('bgCanvas');
const ctx = canvas && canvas.getContext && canvas.getContext('2d');
function fitCanvas(){ if(!canvas) return; canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
fitCanvas();
let particles = [];
if(ctx){
  for(let i=0;i<80;i++){ particles.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:1+Math.random()*2,dx:(Math.random()-.5)*.6,dy:(Math.random()-.5)*.6,opacity:Math.random()}); }
  function animateParticles(){ ctx.clearRect(0,0,canvas.width,canvas.height); particles.forEach(p=>{ ctx.beginPath(); ctx.fillStyle=`rgba(255,255,255,${(document.body.classList.contains('light')?0.22:p.opacity)})`; ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); p.x+=p.dx; p.y+=p.dy; if(p.x<0||p.x>canvas.width)p.dx*=-1; if(p.y<0||p.y>canvas.height)p.dy*=-1; }); requestAnimationFrame(animateParticles); }
  animateParticles(); window.addEventListener('resize', fitCanvas);
}

/* SPA nav */
document.addEventListener('DOMContentLoaded', () => { showLoader(); setTimeout(()=>hideLoader(),800); });
links.forEach(link => {
  link.addEventListener('click', e => {
    e.preventDefault();
    const href = link.getAttribute('href');
    links.forEach(l => l.classList.remove('active'));
    link.classList.add('active');
    pages.forEach(p => { if(p.classList.contains('active')){ p.style.opacity='0'; p.style.transform='translateY(20px)'; setTimeout(()=>p.classList.remove('active'),340); } });
    setTimeout(()=>{
      const target = document.querySelector(href);
      if(target){ target.classList.add('active'); target.style.opacity='1'; target.style.transform='translateY(0)'; }
      hideLoader();
    }, 700);
  });
});

/* hamburger */
const menuToggle = document.getElementById('menu-toggle');
const navMenu = document.querySelector('nav ul');
if(menuToggle) menuToggle.addEventListener('click', ()=> navMenu.classList.toggle('show'));

/* typewriter */
const roles = ["UI/UX Developer","Frontend Engineer","Creative Coder"]; let roleIndex=0,charIndex=0; const typewriter = document.getElementById("typewriter");
function type(){ if(!typewriter) return; if(charIndex < roles[roleIndex].length){ typewriter.textContent += roles[roleIndex].charAt(charIndex++); setTimeout(type,90); } else setTimeout(erase,1600); }
function erase(){ if(!typewriter) return; if(charIndex>0){ typewriter.textContent = roles[roleIndex].substring(0,--charIndex); setTimeout(erase,40);} else { roleIndex=(roleIndex+1)%roles.length; setTimeout(type,400);} } type();

/* theme toggle */
const themeBtn = document.getElementById('theme-toggle');
if(themeBtn) themeBtn.addEventListener('click', ()=>{ document.body.classList.toggle('light'); themeBtn.textContent = document.body.classList.contains('light') ? '🌞' : '🌙'; });

/* -------------------------
   CASE STUDIES DATA + Modal
   ------------------------- */
const caseStudies = {
  klp:{title:"KLP Lifestyle",problem:"E-commerce lacked responsive UI.",process:"Figma redesign + frontend build.",solution:"Delivered clean, mobile UI.",link:"https://klplifestyle.com/"},
  fixifoot:{title:"Fixifoot",problem:"Showcase not engaging.",process:"Interactive grids + responsive design.",solution:"Better UX & conversions.",link:"https://fixifoot.ph/"},
  cveez:{title:"Cveez",problem:"Needed sleek booking UX.",process:"Designed flows + coded frontend.",solution:"Modern booking platform.",link:"https://cveez.com/"},
  other1:{title:"Other 1",problem:"Reusable UI components.",process:"Component library.",solution:"Faster builds.",link:"#"},
  other2:{title:"Other 2",problem:"Landing optimization.",process:"A/B test + frontend.",solution:"Higher conversions.",link:"#"}
};

function openCaseStudy(key){
  const d = caseStudies[key];
  if(!d) return;
  document.getElementById("case-title").textContent = d.title;
  document.getElementById("case-problem").textContent = "Problem: " + d.problem;
  document.getElementById("case-process").textContent = "Process: " + d.process;
  document.getElementById("case-solution").textContent = "Solution: " + d.solution;
  document.getElementById("case-link").href = d.link;
  caseModal.style.display = "flex";
  setTimeout(()=> caseModal.classList.add('show'), 16);
}
function closeCaseStudy(){ caseModal.classList.remove('show'); setTimeout(()=> caseModal.style.display = "none", 220); }
if(closeBtn) closeBtn.addEventListener('click', closeCaseStudy);
window.addEventListener('click', e => { if(e.target === caseModal) closeCaseStudy(); });
window.addEventListener('keydown', e => { if(e.key === 'Escape') closeCaseStudy(); });

/* Grid cards open modal */
document.querySelectorAll('.project-grid .project').forEach(p => {
  p.addEventListener('click', ()=> openCaseStudy(p.dataset.key));
});

/* View toggle between carousel/grid */
function setProjectsView(mode){
  if(mode === 'grid'){
    carouselView.style.display = 'none';
    gridView.style.display = '';
    btnCarousel && btnCarousel.setAttribute('aria-pressed','false');
    btnGrid && btnGrid.setAttribute('aria-pressed','true');
    localStorage.setItem('projectsView','grid');
  } else {
    carouselView.style.display = '';
    gridView.style.display = 'none';
    btnCarousel && btnCarousel.setAttribute('aria-pressed','true');
    btnGrid && btnGrid.setAttribute('aria-pressed','false');
    localStorage.setItem('projectsView','carousel');
  }
}
const savedView = localStorage.getItem('projectsView') || 'carousel';
setProjectsView(savedView);
btnCarousel && btnCarousel.addEventListener('click', ()=> setProjectsView('carousel'));
btnGrid && btnGrid.addEventListener('click', ()=> setProjectsView('grid'));

/* -------------------------
   USER'S ORIGINAL CAROUSEL SCRIPT (unchanged)
   ------------------------- */
document.addEventListener('DOMContentLoaded', async function () {
  // ---- CONFIG ----
  const DATA_URL = '/path/to/your/carousel.json'; // <-- replace with your API endpoint
  const INITIAL_INDEX = 2; // default starting index (will clamp to range)

  // Fallback data (used if fetch fails and no window.CAROUSEL_DATA is present)
  const FALLBACK = [
    {
      img: "https://frontiertowersphilippines.com/wp-content/uploads/2025/08/1-1.png",
      alt: "Card 1",
      title: "Frontier Tree-Planting with EVSU and Tacloban Officials",
      description: "<h2 style='color:#b30000;margin-bottom:10px;'>Frontier Tree-Planting with EVSU and Tacloban Officials</h2><p>Frontier employees based in Leyte, Cebu, and Bohol volunteered with Eastern Visayas University in Tacloban and the Provincial Environment and Natural Resources (PENRO).</p>"
    },
    {
      img: "https://frontiertowersphilippines.com/wp-content/uploads/2025/08/2.png",
      alt: "Card 2",
      title: "Frontier Brigada Eskwela Program",
      description: "<h2 style='color:#b30000;margin-bottom:10px;'>Frontier Brigada Eskwela Program</h2><p>An outreach program for the elementary students of Laurel, Batangas, that covers donation of school supplies and materials together with the LGU.</p>"
    },
    {
      img: "https://frontiertowersphilippines.com/wp-content/uploads/2025/08/3.png",
      alt: "Card 3",
      title: "",
      description: ""
    },
    {
      img: "https://frontiertowersphilippines.com/wp-content/uploads/2025/08/4.png",
      alt: "Card 4",
      title: "Libreng Gulay Partnership with GoodFood Community",
      description: "<h2 style='color:#b30000;margin-bottom:10px;'>Libreng Gulay Partnership with GoodFood Community</h2><p>Supports a community farm, helping local farmers in crop distribution, and, at the same time, promoting sustainable behavior among its employees with Libreng Gulay.</p>"
    },
    {
      img: "https://frontiertowersphilippines.com/wp-content/uploads/2025/08/5.png",
      alt: "Card 5",
      title: "Project Flip in Baguio in 2022",
      description: "<h2 style='color:#b30000;margin-bottom:10px;'>Project Flip in Baguio in 2022</h2><p>As part of our Annual Conference in 2022, we volunteered for an outreach program and tutoring services for the children of Bancua, Dontogan led by BFLI (Breakfast Feeding for Learning Inc.).</p>"
    },
    {
      img: "https://frontiertowersphilippines.com/wp-content/uploads/2025/08/6.png",
      alt: "Card 6",
      title: "Other Donations, Sponsorships, and Charitable Assistance",
      description: `
        <h2 style="color:#b30000; margin-bottom:10px;">
          Other Donations, Sponsorships, and Charitable Assistance
        </h2>
        <p>
          Frontier also made and will continue to provide support to community development initiatives, immediate disaster relief operations to areas in need and charitable assistance to its existing and future recipient organizations and communities.
        </p>
        <div style="display:flex; justify-content:center; gap:20px; flex-wrap:wrap; margin-top:15px;">
          <img src="https://frontiertowersphilippines.com/wp-content/uploads/2025/08/1-2.png" alt="Logo1" style="height:60px;">
          <img src="https://frontiertowersphilippines.com/wp-content/uploads/2025/08/2-1.png" alt="Logo2" style="height:60px;">
          <img src="https://frontiertowersphilippines.com/wp-content/uploads/2025/08/3-1.png" alt="Logo3" style="height:60px;">
          <img src="https://frontiertowersphilippines.com/wp-content/uploads/2025/08/4-1.png" alt="Logo4" style="height:60px;">
          <img src="https://frontiertowersphilippines.com/wp-content/uploads/2025/08/5-1.png" alt="Logo4" style="height:60px;">
          <img src="https://frontiertowersphilippines.com/wp-content/uploads/2025/08/6-1.png" alt="Logo4" style="height:60px;">
          <img src="https://frontiertowersphilippines.com/wp-content/uploads/2025/08/7.png" alt="Logo4" style="height:60px;">
        </div>
      `
    }
  ];

  // ---- ELEMENTS ----
  const container = document.querySelector('.carousel-track-container');
  const track = document.querySelector('.carousel-track');
  const prevBtn = document.querySelector('.arrow-btn.prev');
  const nextBtn = document.querySelector('.arrow-btn.next');
  const descriptionBox = document.querySelector('.carousel-description');

  let slides = [];
  let currentIndex = 0;
  let transformX = 0;

  // ---- HELPERS ----
  function clamp(n, min, max) { return Math.max(min, Math.min(max, n)); }

  function buildSlides(data) {
    const frag = document.createDocumentFragment();
    data.forEach(item => {
      const slide = document.createElement('div');
      slide.className = 'carousel-slide';
      slide.dataset.description = item.description ? String(item.description) : '';

      const img = document.createElement('img');
      img.src = item.img || '';
      img.alt = item.alt || '';

      const p = document.createElement('p');
      p.textContent = (item.title || '').trim();

      if (!p.textContent) {
        p.classList.add('hidden');
        slide.classList.add('no-title');
      }

      slide.appendChild(img);
      slide.appendChild(p);
      frag.appendChild(slide);
    });

    track.innerHTML = '';
    track.appendChild(frag);
    slides = Array.from(track.querySelectorAll('.carousel-slide'));

    // Click to activate
    slides.forEach((slide, index) => {
      slide.addEventListener('click', () => {
        currentIndex = index;
        centerActive();
      });
    });
  }

  function updateButtons() {
    prevBtn.disabled = currentIndex === 0;
    nextBtn.disabled = currentIndex === slides.length - 1;
  }

  function updateDescription() {
    const desc = slides[currentIndex].dataset.description || '';
    if (desc.trim()) {
      // Only safe if your API is trusted:
      descriptionBox.innerHTML = desc;
      descriptionBox.classList.remove('hidden');
    } else {
      descriptionBox.innerHTML = '';
      descriptionBox.classList.add('hidden');
    }
  }

  function centerActive() {
    if (!slides.length) return;

    slides.forEach(s => s.classList.remove('active'));
    slides[currentIndex].classList.add('active');

    const active = slides[currentIndex];
    const containerWidth = container.clientWidth;
    const targetCenter = active.offsetLeft + (active.offsetWidth / 2);
    const desired = -(targetCenter - (containerWidth / 2));

    transformX = desired+79;
    track.style.transform = `translateX(${transformX}px)`;

    updateButtons();
    updateDescription();
  }

  async function loadData() {
    if (Array.isArray(window.CAROUSEL_DATA)) return window.CAROUSEL_DATA;

    try {
      const res = await fetch(DATA_URL, { cache: 'no-store' });
      if (!res.ok) throw new Error('Bad response');
      const json = await res.json();
      if (!Array.isArray(json)) throw new Error('JSON must be an array');
      return json;
    } catch (err) {
      console.warn('Carousel: using fallback data. Reason:', err);
      return FALLBACK;
    }
  }

  // ---- INIT ----
  const data = await loadData();
  buildSlides(data);
  currentIndex = clamp(INITIAL_INDEX, 0, Math.max(0, slides.length - 1));

  prevBtn.addEventListener('click', () => {
    if (currentIndex > 0) {
      currentIndex--;
      centerActive();
    }
  });

  nextBtn.addEventListener('click', () => {
    if (currentIndex < slides.length - 1) {
      currentIndex++;
      centerActive();
    }
  });

  window.addEventListener('resize', centerActive);

  centerActive();
});
</script>
</body>
</html>
