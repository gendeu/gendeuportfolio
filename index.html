<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gen Deu Gagarin | UI/UX Portfolio (Carousel Fixed)</title>
  <meta name="description" content="Gen Deu Gagarin â€” UI/UX Developer & Frontend Engineer" />
  <style>
/* ---------- Base + Theme ---------- */
:root{--bg1:#0f2027;--bg2:#203a43;--bg3:#2c5364;--text:#f5f5f5;--accent:#00f2fe;--glass-bg:rgba(255,255,255,0.08);--glass-border:rgba(255,255,255,0.2)}
body.light{--bg1:#dbe6f6;--bg2:#cfd9df;--bg3:#e2ebf0;--text:#222;--accent:#3f51b5;--glass-bg:rgba(255,255,255,0.5);--glass-border:rgba(0,0,0,0.1)}
*{box-sizing:border-box}html,body{height:100%;margin:0;font-family:'Poppins',system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;color:var(--text);-webkit-font-smoothing:antialiased}
body{background:linear-gradient(-45deg,var(--bg1),var(--bg2),var(--bg3));background-size:400% 400%;animation:gradientMove 25s ease infinite;transition:background .8s ease,color .3s ease}
@keyframes gradientMove{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
a{color:var(--accent);text-decoration:none}

/* ---------- Layout (reduced header padding) ---------- */
header{position:sticky;top:0;z-index:1000;backdrop-filter:blur(12px);padding:.6rem 1rem}
nav{display:flex;justify-content:space-between;align-items:center;gap:1rem}nav ul{list-style:none;display:flex;gap:1.25rem;margin:0;padding:0}nav ul li a{text-decoration:none;color:var(--text);position:relative;padding:.25rem .1rem}nav ul li a::after{content:"";position:absolute;left:0;bottom:-4px;width:100%;height:2px;background:var(--accent);transform:scaleX(0);transition:transform .3s ease;transform-origin:left}nav ul li a:hover::after{transform:scaleX(1)}
#menu-toggle{display:none;cursor:pointer;font-size:1.25rem}
.page{display:none;opacity:0;transform:translateY(20px);transition:opacity .45s ease,transform .45s ease;min-height:72vh;padding:2.5rem 1.25rem}.page.active{display:block;opacity:1;transform:translateY(0)}
.hero{text-align:center;margin-top:10vh;padding:1.5rem}.highlight{color:var(--accent)}
.card.glass{padding:1.25rem;border-radius:16px;background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:blur(12px);margin:1rem auto;width:92%;max-width:1000px;text-align:center;transition:transform .22s ease,box-shadow .22s ease}
.btn{display:inline-block;margin-top:.65rem;padding:.5rem .9rem;border-radius:28px;background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:blur(8px);color:var(--accent);font-weight:600;text-decoration:none;transition:transform .15s ease,background .15s ease}
.btn:hover{transform:scale(1.03)}
.muted{color:rgba(255,255,255,.72);font-size:.95rem}

/* Projects header + view toggle */
.projects-header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:10px}
.view-toggle{display:flex;gap:8px}
.view-btn{width:40px;height:40px;border-radius:8px;border:1px solid rgba(255,255,255,.06);background:transparent;color:var(--text);cursor:pointer;font-size:18px;display:flex;align-items:center;justify-content:center}
.view-btn[aria-pressed="true"]{background:var(--accent);color:#071225;box-shadow:0 8px 18px rgba(0,0,0,.35);border-color:rgba(255,255,255,.08)}

/* Grid view */
.project-grid{display:grid;gap:1rem;grid-template-columns:repeat(3,1fr)}@media (max-width:1024px){.project-grid{grid-template-columns:repeat(2,1fr)}}@media (max-width:720px){.project-grid{grid-template-columns:1fr}}
.project-grid .project{padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.02);cursor:pointer;transition:transform .18s ease}
.project-grid .project:hover{transform:translateY(-6px)}

/* ---------- CAROUSEL (improved, responsive) ---------- */
.custom-carousel{
  position:relative;
  max-width:1000px;
  margin:0 auto;
  display:flex;
  align-items:center;
  justify-content:center;
}
.carousel-track-container{
  width:100%;
  min-height:303px;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
  position:relative;
  touch-action: pan-y; /* allow vertical page scroll while enabling horizontal pointer handling */
}
.carousel-track{
  display:flex;
  transition:transform .42s cubic-bezier(.22,.9,.29,1);
  will-change:transform;
  position:relative;
  left:0;
  user-select:none;
  -webkit-user-drag:none;
  touch-action: none;
}
.carousel-slide{
  flex:0 0 auto;
  width:190px;
  max-height: 240px;
  margin:0 10px;
  background:#fff;
  overflow:hidden;
  text-align:center;
  opacity:.6;
  transition:transform .28s ease,opacity .28s ease,box-shadow .28s ease;
  display:flex;
  flex-direction:column;
  cursor:pointer;
  border: 2px solid rgba(0,0,0,0.06);
  border-radius:10px;
}
.carousel-slide img{ width:100%; object-fit:cover; display:block; }
.carousel-slide p{ background:#f5f5f5;margin:0;height:72px;padding:8px;font-size:13px;font-weight:600;color:#333;display:flex;align-items:center;justify-content:center }
.carousel-slide p.hidden { display:none; }
.carousel-slide.no-title img { height:100%; object-fit:scale-down; }
.carousel-slide.no-title { flex-direction:row; }
.carousel-slide.active{
  transform: translateY(-10px) scale(1.14);
  opacity:1;
  box-shadow:0 18px 44px rgba(2,6,23,0.45);
  z-index:20;
}

/* Arrows */
.arrow-btn{
  position:absolute; top:50%; transform:translateY(-50%); background:#fff; border:none; width:44px; height:44px; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer; box-shadow:rgba(0,0,0,0.12) 0px 8px 14px; z-index:25; transition:transform .12s ease;
}
.arrow-btn svg{ width:28px; height:28px; fill:#333 }
.arrow-btn:hover{ transform:translateY(-50%) scale(1.03) }
.arrow-btn.prev{ left:8px } .arrow-btn.next{ right:8px } .arrow-btn:disabled{ opacity:.3; cursor:not-allowed; }

/* detail below carousel (visible) */
.carousel-detail{
  max-width:1000px;margin:18px auto 36px;padding:14px;border-radius:12px;background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:blur(8px);color:var(--text);
  display:block;
}
.carousel-detail h4{margin:0 0 6px 0}
.carousel-detail p{margin:0;color:rgba(255,255,255,.85);line-height:1.45}

/* Modal (grid uses modal) */
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);justify-content:center;align-items:center;z-index:6000;opacity:0;transition:opacity .25s ease}.modal.show{display:flex;opacity:1}
.modal-content{max-width:820px;padding:1.25rem;border-radius:12px;background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:blur(15px);transform:translateY(0);opacity:1;position:relative;color:var(--text)}
.modal-content img{max-width:280px;width:100%;height:auto;border-radius:8px;object-fit:cover;float:left;margin-right:14px}
.modal-left{display:flex;flex-direction:row;gap:12px;align-items:flex-start}
.close{position:absolute;top:10px;right:12px;font-size:1.25rem;cursor:pointer}

/* small screens */
@media (max-width:900px){
  .carousel-slide{ width:220px }
}
@media (max-width:640px){
  .carousel-slide{ width:160px }
  .carousel-detail{ margin:12px 12px 28px }
  header{padding:.55rem .75rem}
  .modal-content img{display:none}
  .modal-left{flex-direction:column}
}
</style>
</head>
<body>

  <!-- Loader -->
  <div id="loader" aria-hidden="true" style="position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);z-index:7000;opacity:0;pointer-events:none;">
    <div style="width:72px;height:72px;border-radius:50%;background:var(--glass-bg);border:2px solid var(--glass-border);display:flex;align-items:center;justify-content:center;color:var(--accent);font-weight:700">GD</div>
  </div>
  <div id="dim" aria-hidden="true" style="position:fixed;inset:0;background:rgba(0,0,0,.28);z-index:6900;opacity:0;pointer-events:none;"></div>

  <!-- Particle Background -->
  <canvas id="bgCanvas" style="position:fixed;inset:0;z-index:-2"></canvas>

  <!-- Navbar -->
  <header>
    <nav>
      <h1 class="logo" style="margin:0;font-size:1.05rem">GenDeu</h1>
      <div id="menu-toggle">â˜°</div>
      <ul>
        <li><a href="#home" class="nav-link active">Home</a></li>
        <li><a href="#about" class="nav-link">About</a></li>
        <li><a href="#projects" class="nav-link">Projects</a></li>
        <li><a href="#skills" class="nav-link">Skills</a></li>
        <li><a href="#contact" class="nav-link">Contact</a></li>
      </ul>
      <button id="theme-toggle">ðŸŒ™</button>
    </nav>
  </header>

  <!-- Hero -->
  <section id="home" class="page active">
    <div class="hero">
      <h2>Hello, Iâ€™m <span class="highlight">Gen Deu</span></h2>
      <p class="tagline"><span id="typewriter"></span></p>
      <a href="#projects" class="btn nav-link">See My Work</a>
    </div>
  </section>

  <!-- About -->
  <section id="about" class="page">
    <h2>About Me</h2>
    <div class="card glass">
      <p>Iâ€™m a UI/UX Developer and Frontend Engineer passionate about creating sleek, user-focused web experiences.</p>
    </div>
  </section>

  <!-- Projects -->
  <section id="projects" class="page">
    <div class="projects-header">
      <h2>Case Studies</h2>
      <div class="view-toggle" role="tablist" aria-label="Projects view toggle">
        <button id="btn-carousel" class="view-btn" aria-pressed="true" title="Carousel view">ðŸŽ®</button>
        <button id="btn-grid" class="view-btn" aria-pressed="false" title="Grid view">â–¦</button>
      </div>
    </div>

    <!-- Carousel view -->
    <div id="carouselView" class="custom-carousel" aria-hidden="false">
      <button class="arrow-btn prev" tabindex="0" aria-label="Previous">
        <svg viewBox="0 0 256 512" aria-hidden="true"><path d="M31.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L127.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L201.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34z"></path></svg>
      </button>

      <div class="carousel-track-container">
        <div class="carousel-track" role="listbox" aria-label="Project carousel"><!-- slides injected by JS --></div>
      </div>

      <button class="arrow-btn next" tabindex="0" aria-label="Next">
        <svg viewBox="0 0 256 512" aria-hidden="true"><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9L128.1 256 31.7 159.6c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"></path></svg>
      </button>
    </div>

    <!-- detail below carousel -->
    <div id="carouselDetail" class="carousel-detail" aria-live="polite" style="display:none;">
      <h4 id="detail-title"></h4>
      <p id="detail-short"></p>
    </div>

    <!-- Grid / list view -->
    <div id="gridView" class="project-grid" style="display:none;">
      <div class="card glass project" data-key="proj-portfolio"><h3>Portfolio Site</h3><p>Personal portfolio & case study</p></div>
      <div class="card glass project" data-key="proj-redesign"><h3>Redesign Concept</h3><p>Website redesign case</p></div>
      <div class="card glass project" data-key="proj-dashboard"><h3>Analytics Dashboard</h3><p>Data dashboard UI</p></div>
      <div class="card glass project" data-key="proj-mobile"><h3>Mobile App</h3><p>Mobile UX flows</p></div>
      <div class="card glass project" data-key="proj-ecom"><h3>E-commerce UI</h3><p>Product & checkout UX</p></div>
      <div class="card glass project" data-key="proj-designsystem"><h3>Design System</h3><p>Component library</p></div>
    </div>

  </section>

  <!-- Modal for grid items (kept) -->
  <div id="case-study" class="modal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true">
      <span class="close" title="Close modal">&times;</span>
      <div class="modal-left">
        <img id="modal-thumb" src="" alt="">
        <div>
          <h3 id="modal-title"></h3>
          <p id="modal-role" class="muted"></p>
          <div id="modal-body" style="margin-top:8px;line-height:1.45;"></div>
          <p style="margin-top:12px;"><a id="modal-link" href="#" target="_blank" class="btn">View Live</a></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Skills -->
  <section id="skills" class="page">
    <h2>Skills</h2>
    <div class="card glass">
      <p>HTML5 Â· CSS3 Â· JavaScript Â· React Â· Figma Â· UI/UX</p>
    </div>
  </section>

  <!-- Contact -->
  <section id="contact" class="page">
    <h2>Contact</h2>
    <div class="card glass">
      <p>Email: <a href="mailto:gendeulgagarin@gmail.com">gendeulgagarin@gmail.com</a></p>
    </div>
  </section>

<footer style="text-align:center;padding:1.25rem;color:rgba(255,255,255,.7)">Â© 2025 Gen Deu Gagarin</footer>

<script>
/* -------------------------
   App JS: SPA, particles, typewriter, theme
   + improved carousel with responsive centering, smooth drag, detail-below
   ------------------------- */

/* Basic helpers */
const qs = (s, root=document) => root.querySelector(s);
const qsa = (s, root=document) => Array.from(root.querySelectorAll(s));

/* SPA nav + loader (minimal) */
const links = qsa('.nav-link');
const pages = qsa('.page');
const loaderEl = qs('#loader');
const dimEl = qs('#dim');
const themeBtn = qs('#theme-toggle');
function showLoader(){ loaderEl && (loaderEl.style.opacity = '1'); dimEl && (dimEl.style.opacity = '1'); }
function hideLoader(){ loaderEl && (loaderEl.style.opacity = '0'); dimEl && (dimEl.style.opacity = '0'); }

document.addEventListener('DOMContentLoaded', () => { showLoader(); setTimeout(()=>hideLoader(),700); });
links.forEach(link => {
  link.addEventListener('click', e => {
    e.preventDefault();
    const href = link.getAttribute('href');
    links.forEach(l=>l.classList.remove('active'));
    link.classList.add('active');
    pages.forEach(p=>{ if(p.classList.contains('active')){ p.style.opacity='0'; p.style.transform='translateY(20px)'; setTimeout(()=>p.classList.remove('active'),300); }});
    setTimeout(()=>{ const t = document.querySelector(href); if(t){ t.classList.add('active'); t.style.opacity='1'; t.style.transform='translateY(0)'; } hideLoader(); }, 560);
  });
});

/* typewriter */
const typewriter = qs('#typewriter');
const roles = ["UI/UX Developer","Frontend Engineer","Creative Coder"]; let roleIndex=0,charIndex=0;
(function type(){ if(!typewriter) return; if(charIndex<roles[roleIndex].length){ typewriter.textContent += roles[roleIndex].charAt(charIndex++); setTimeout(type,80);} else setTimeout(erase,1400); })();
function erase(){ if(!typewriter) return; if(charIndex>0){ typewriter.textContent = roles[roleIndex].substring(0,--charIndex); setTimeout(erase,32);} else { roleIndex=(roleIndex+1)%roles.length; setTimeout(type,380);} }

/* theme toggle */
if(themeBtn) themeBtn.addEventListener('click', ()=>{ document.body.classList.toggle('light'); themeBtn.textContent = document.body.classList.contains('light') ? 'ðŸŒž' : 'ðŸŒ™'; });

/* particles (kept simple) */
const canvas = qs('#bgCanvas'); const ctx = canvas && canvas.getContext && canvas.getContext('2d');
function fitCanvas(){ if(!canvas) return; canvas.width = innerWidth; canvas.height = innerHeight; }
fitCanvas();
let particles = [];
if(ctx){
  for(let i=0;i<60;i++){ particles.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:1+Math.random()*2,dx:(Math.random()-.5)*.6,dy:(Math.random()-.5)*.6,opacity:Math.random()}); }
  (function animate(){ ctx.clearRect(0,0,canvas.width,canvas.height); particles.forEach(p=>{ ctx.beginPath(); ctx.fillStyle = `rgba(255,255,255,${document.body.classList.contains('light')?0.22:p.opacity})`; ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); p.x+=p.dx; p.y+=p.dy; if(p.x<0||p.x>canvas.width) p.dx*=-1; if(p.y<0||p.y>canvas.height) p.dy*=-1; }); requestAnimationFrame(animate); })();
  addEventListener('resize', fitCanvas);
}

/* -------------------------
   Projects data (placeholder thumbnails)
   ------------------------- */
const projects = [
  { key:'proj-portfolio', title:'Portfolio Site', role:'UI/UX / Frontend', img:'https://via.placeholder.com/600x360.png?text=Portfolio', short:'Personal portfolio with case studies and UI experiments.', details:'<p>Responsive portfolio; focus on content-first case studies and performance.</p>', live:'#' },
  { key:'proj-redesign', title:'Redesign Concept', role:'UI/UX Lead', img:'https://via.placeholder.com/600x360.png?text=Redesign', short:'Website redesign focusing on clarity and conversion.', details:'<p>IA improvements, clearer CTAs and a refreshed visual system.</p>', live:'#' },
  { key:'proj-dashboard', title:'Analytics Dashboard', role:'Frontend Engineer', img:'https://via.placeholder.com/600x360.png?text=Dashboard', short:'Interactive analytics UI with filters and charts.', details:'<p>Reusable chart components and responsive layouts for large datasets.</p>', live:'#' },
  { key:'proj-mobile', title:'Mobile App Flows', role:'Product Designer', img:'https://via.placeholder.com/600x360.png?text=Mobile', short:'Mobile-first UX flows & prototypes.', details:'<p>Task-focused flows and micro-interactions to reduce drop-off.</p>', live:'#' },
  { key:'proj-ecom', title:'E-commerce UI', role:'UX / Frontend', img:'https://via.placeholder.com/600x360.png?text=Ecommerce', short:'Product listing & checkout improvements.', details:'<p>Improved product discovery and accessible checkout forms.</p>', live:'#' },
  { key:'proj-designsystem', title:'Design System', role:'Design System Owner', img:'https://via.placeholder.com/600x360.png?text=Design+System', short:'Component library & tokens for consistency.', details:'<p>Component library with tokens and documentation.</p>', live:'#' }
];

/* -------------------------
   Carousel implementation (improved)
   ------------------------- */
(function initCarousel(){
  const container = qs('.carousel-track-container');
  const track = qs('.carousel-track');
  const prevBtn = qs('.arrow-btn.prev');
  const nextBtn = qs('.arrow-btn.next');
  const detailBox = qs('#carouselDetail');
  const detailTitle = qs('#detail-title');
  const detailShort = qs('#detail-short');

  if(!container || !track) return;
  let slides = [];
  let currentIndex = Math.floor(projects.length/2); // default centered index
  let isDragging = false;
  let startX = 0;
  let startTranslate = 0;
  let rafPending = false;

  // build slides
  function build(){
    const frag = document.createDocumentFragment();
    projects.forEach(p => {
      const s = document.createElement('div');
      s.className = 'carousel-slide';
      s.dataset.key = p.key;
      s.dataset.title = p.title;
      s.dataset.img = p.img;
      s.dataset.role = p.role;
      s.dataset.short = p.short;
      s.dataset.details = p.details;
      s.dataset.live = p.live;

      const img = document.createElement('img'); img.src = p.img; img.alt = p.title;
      const txt = document.createElement('p'); txt.textContent = p.title || '';
      if(!txt.textContent){ txt.classList.add('hidden'); s.classList.add('no-title'); }
      s.appendChild(img); s.appendChild(txt);
      frag.appendChild(s);

      // click behavior: center if not centered; if centered, optionally toggle (we just keep detail below)
      s.addEventListener('click', ()=> {
        if(isCentered(s)) { /* do nothing: detail is below and auto-updates on center */ }
        else { currentIndex = slides.indexOf(s); centerActive(true); }
      });

      s.tabIndex = 0;
      s.addEventListener('keydown', ev => { if(ev.key==='Enter' || ev.key===' ') { ev.preventDefault(); s.click(); } });
    });

    track.innerHTML = '';
    track.appendChild(frag);
    slides = qsa('.carousel-slide', track);
  }

  // compute translate so that slides[currentIndex] is centered
  function centerActive(smooth=true){
    if(!slides.length) return;
    slides.forEach(sl => sl.classList.remove('active'));
    const active = slides[currentIndex];
    if(!active) return;
    active.classList.add('active');

    // compute center translate
    const containerW = container.clientWidth;
    const targetCenter = active.offsetLeft + active.offsetWidth/2;
    // desired translateX such that targetCenter becomes container center: translate = containerCenter - targetCenter
    let translate = (containerW/2) - targetCenter;
    // clamp translate so track edges don't show blank space
    const trackW = track.scrollWidth;
    const maxTranslate = 0;
    const minTranslate = Math.min(containerW - trackW, 0);
    translate = Math.max(minTranslate, Math.min(maxTranslate, translate));
    // apply transform
    track.style.transition = smooth ? '' : 'none';
    track.style.transform = `translateX(${translate}px)`;

    // update detail below
    updateDetail(active);

    // update buttons disabled state
    prevBtn && (prevBtn.disabled = currentIndex === 0);
    nextBtn && (nextBtn.disabled = currentIndex === slides.length - 1);
  }

  function updateDetail(activeSlide){
    if(!activeSlide) { detailBox.style.display = 'none'; return; }
    const title = activeSlide.dataset.title || '';
    const short = activeSlide.dataset.short || '';
    detailTitle.textContent = title;
    detailShort.textContent = short;
    detailBox.style.display = (title||short) ? '' : 'none';
  }

  function isCentered(el){
    if(!el) return false;
    const containerRect = container.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const centerEl = elRect.left + (elRect.width/2);
    const centerContainer = containerRect.left + (containerRect.width/2);
    return Math.abs(centerEl - centerContainer) < (elRect.width * 0.38); // threshold adjustable
  }

  // arrow handlers
  prevBtn && prevBtn.addEventListener('click', ()=>{ if(currentIndex>0){ currentIndex--; centerActive(); }});
  nextBtn && nextBtn.addEventListener('click', ()=>{ if(currentIndex<slides.length-1){ currentIndex++; centerActive(); }});

  // Pointer drag handling (smooth, non-glitch)
  function getCurrentTranslate(){
    const st = getComputedStyle(track).transform;
    if(st && st !== 'none'){
      const m = st.match(/matrix\\(([^)]+)\\)/);
      if(m){
        const nums = m[1].split(',').map(s=>parseFloat(s.trim()));
        return nums[4] || 0;
      }
    }
    return 0;
  }

  track.addEventListener('pointerdown', (ev) => {
    isDragging = true;
    startX = ev.clientX;
    startTranslate = getCurrentTranslate();
    track.setPointerCapture(ev.pointerId);
    track.style.transition = 'none';
  }, { passive: true });

  track.addEventListener('pointermove', (ev) => {
    if(!isDragging) return;
    const dx = ev.clientX - startX;
    let next = startTranslate + dx;
    // clamp
    const min = Math.min(container.clientWidth - track.scrollWidth, 0);
    const max = 0;
    if(next < min) next = min;
    if(next > max) next = max;
    // apply using raf for smoothness
    if(!rafPending){
      rafPending = true;
      requestAnimationFrame(()=>{ track.style.transform = `translateX(${next}px)`; rafPending = false; });
    }
  }, { passive: true });

  const endPointer = (ev) => {
    if(!isDragging) return;
    isDragging = false;
    try{ track.releasePointerCapture(ev && ev.pointerId); }catch(e){}
    // snap to nearest slide
    const containerRect = container.getBoundingClientRect();
    const centerX = containerRect.left + (containerRect.width/2);
    let best = 0, bestDist = Infinity;
    slides.forEach((s,i)=>{ const r = s.getBoundingClientRect(); const c = r.left + r.width/2; const d = Math.abs(c - centerX); if(d < bestDist){ bestDist = d; best = i; } });
    currentIndex = best;
    // restore transition and center
    track.style.transition = '';
    centerActive(true);
  };

  track.addEventListener('pointerup', endPointer);
  track.addEventListener('pointercancel', endPointer);
  track.addEventListener('pointerleave', (ev)=>{ if(isDragging) endPointer(ev); });

  // on resize, recenter active
  let resizeTimer = null;
  window.addEventListener('resize', ()=>{ clearTimeout(resizeTimer); resizeTimer = setTimeout(()=>centerActive(false), 80); });

  // Build and init
  build();
  // start with middle item centered
  currentIndex = Math.floor(slides.length/2);
  setTimeout(()=>centerActive(false), 80);

  // auto-center when carousel becomes visible (for view toggle)
  window.centerProjectsCarousel = () => { // exposed function used by view toggle
    // ensure slides exist
    if(!slides.length) return;
    // choose last stored index or keep currentIndex
    currentIndex = Math.max(0, Math.min(currentIndex, slides.length-1));
    setTimeout(()=>centerActive(true), 80);
  };

  // expose utilities for debugging
  window._carousel = { slides, centerActive };

})(); // end carousel init

/* -------------------------
   Grid modal (when clicking grid cards)
   ------------------------- */
(function initGridModal(){
  const modal = qs('#case-study');
  const close = qs('#case-study .close');
  const modalThumb = qs('#modal-thumb');
  const modalTitle = qs('#modal-title');
  const modalRole = qs('#modal-role');
  const modalBody = qs('#modal-body');
  const modalLink = qs('#modal-link');

  function open(key){
    const p = projects.find(x => x.key === key);
    if(!p) return;
    modalThumb.src = p.img; modalThumb.alt = p.title;
    modalTitle.textContent = p.title; modalRole.textContent = p.role;
    modalBody.innerHTML = p.details || `<p>${p.short || ''}</p>`;
    modalLink.href = p.live || '#';
    modal.style.display = 'flex';
    setTimeout(()=>modal.classList.add('show'), 12);
  }
  function closeModal(){ modal.classList.remove('show'); setTimeout(()=> modal.style.display='none', 180); }

  // wire grid cards
  qsa('.project-grid .project').forEach(el => {
    el.addEventListener('click', ()=> open(el.dataset.key));
  });

  close && close.addEventListener('click', closeModal);
  window.addEventListener('click', e => { if(e.target === modal) closeModal(); });
  window.addEventListener('keydown', e => { if(e.key==='Escape') closeModal(); });
})();

/* -------------------------
   View toggle: show carousel and auto-center
   ------------------------- */
(function viewToggle(){
  const btnCarousel = qs('#btn-carousel');
  const btnGrid = qs('#btn-grid');
  const carouselView = qs('#carouselView');
  const gridView = qs('#gridView');

  function setView(mode){
    if(mode==='grid'){ carouselView.style.display='none'; gridView.style.display='grid'; btnCarousel && btnCarousel.setAttribute('aria-pressed','false'); btnGrid && btnGrid.setAttribute('aria-pressed','true'); localStorage.setItem('projectsView','grid'); }
    else{ carouselView.style.display=''; gridView.style.display='none'; btnCarousel && btnCarousel.setAttribute('aria-pressed','true'); btnGrid && btnGrid.setAttribute('aria-pressed','false'); localStorage.setItem('projectsView','carousel'); /* center */ window.centerProjectsCarousel && window.centerProjectsCarousel(); }
  }

  const saved = localStorage.getItem('projectsView') || 'carousel';
  setView(saved);

  btnCarousel && btnCarousel.addEventListener('click', ()=> setView('carousel'));
  btnGrid && btnGrid.addEventListener('click', ()=> setView('grid'));
})();

</script>
</body>
</html>
