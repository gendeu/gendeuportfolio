<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Carousel Demo</title>
  <style>
  /* ---- your carousel CSS (kept mostly as provided) ---- */
  .custom-carousel{
    position:relative;
    max-width:1000px;
    margin:0 auto;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .carousel-track-container{
    width:100%;
    min-height:303px;
    display:flex;
    align-items:center;
    justify-content:center;
    overflow:hidden;
    position:relative;
  }

  .carousel-track{
    display:flex;
    transition:transform .5s ease;
    will-change:transform;
    position: absolute;
    left: 0;
    top: 0;
  }

  .carousel-slide{
    flex:0 0 auto;
    width:190px;
    max-height: 240px;
    margin:0 10px;
    background:#fff;
    overflow:hidden;
    text-align:center;
    opacity:.5;
    transition:all .3s ease;
    display:flex;
    flex-direction:column;
    cursor:pointer;
    border: 3px gray solid;
    border-radius:8px;
  }

  .carousel-slide img{
    width:100%;
    object-fit:cover;
    display:block;
  }

  .carousel-slide p{
      background: #f5f5f5;
      margin: 0;
      height: 90px;
      padding: 10px;
      font-size: 14px;
      font-weight: 600;
      color: #333;
      align-items: center;
      text-align: center;
      justify-content: center;
      display: flex;
  }

  .carousel-slide p.hidden { display:none; }
  .carousel-slide.no-title img { height:100%; object-fit:scale-down; }
  .carousel-slide.no-title { flex-direction:row; }

  .carousel-slide.active{
    transform: scale(1.2);
    opacity:1;
    box-shadow:0 2px 6px rgba(0,0,0,0.1);
    z-index:2;
    margin: 0 7px;
  }

  /* Arrow buttons */
  .arrow-btn {
    position:absolute;
    top:50%;
    transform:translateY(-50%);
    background:#fff;
    border:none;
    width:44px;
    height:44px;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    box-shadow:rgba(0,0,0,0.19) 0px 6px 8px;
    z-index:3;
    transition:background 0.2s ease;
  }

  .arrow-btn svg { width:36px; height:36px; fill:#333; }
  .arrow-btn:hover { background:#f0f0f0; }
  .arrow-btn.prev { left:6px; }
  .arrow-btn.next { right:6px; }
  .arrow-btn:disabled { opacity:.3; cursor:not-allowed; }

  .carousel-description{
    max-width:800px;
    margin:20px auto 0;
    padding:15px;
    font-size:16px;
    color:#444;
    line-height:1.4;
    text-align:center;
  }
  .carousel-description.hidden { display:none; }

  /* small responsive tweak */
  @media (max-width:560px){
    .carousel-slide{ width:150px; }
  }
  </style>
</head>
<body>

  <!-- MARKUP (use this exact structure) -->
  <div class="custom-carousel" aria-hidden="false">
    <button class="arrow-btn prev" tabindex="0" aria-label="Previous">
      <svg viewBox="0 0 256 512" aria-hidden="true"><path d="M31.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L127.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L201.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34z"></path></svg>
    </button>

    <div class="carousel-track-container">
      <div class="carousel-track" role="list"><!-- slides injected here --></div>
    </div>

    <button class="arrow-btn next" tabindex="0" aria-label="Next">
      <svg viewBox="0 0 256 512" aria-hidden="true"><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9L128.1 256 31.7 159.6c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"></path></svg>
    </button>
  </div>

  <!-- Description -->
  <div class="carousel-description hidden" aria-live="polite"></div>

<script>
/* Complete JS: improved centering + modal + setCarouselMode
   Replace DATA_URL below if you have an API endpoint.
*/
document.addEventListener('DOMContentLoaded', async () => {
  // ---- CONFIG ----
  const DATA_URL = '/path/to/your/carousel.json'; // <-- replace with your API endpoint or leave as-is
  const INITIAL_INDEX = 2; // default starting index (0-based)

  // ---- FALLBACK DATA (from your example) ----
  const FALLBACK = [
    {
      img: "https://frontiertowersphilippines.com/wp-content/uploads/2025/08/1-1.png",
      alt: "Card 1",
      title: "Frontier Tree-Planting with EVSU and Tacloban Officials",
      description: "<h2 style='color:#b30000;margin-bottom:10px;'>Frontier Tree-Planting with EVSU and Tacloban Officials</h2><p>Frontier employees based in Leyte, Cebu, and Bohol volunteered with Eastern Visayas University in Tacloban and the Provincial Environment and Natural Resources (PENRO).</p>"
    },
    {
      img: "https://frontiertowersphilippines.com/wp-content/uploads/2025/08/2.png",
      alt: "Card 2",
      title: "Frontier Brigada Eskwela Program",
      description: "<h2 style='color:#b30000;margin-bottom:10px;'>Frontier Brigada Eskwela Program</h2><p>An outreach program for the elementary students of Laurel, Batangas, that covers donation of school supplies and materials together with the LGU.</p>"
    },
    {
      img: "https://frontiertowersphilippines.com/wp-content/uploads/2025/08/3.png",
      alt: "Card 3",
      title: "",
      description: ""
    },
    {
      img: "https://frontiertowersphilippines.com/wp-content/uploads/2025/08/4.png",
      alt: "Card 4",
      title: "Libreng Gulay Partnership with GoodFood Community",
      description: "<h2 style='color:#b30000;margin-bottom:10px;'>Libreng Gulay Partnership with GoodFood Community</h2><p>Supports a community farm, helping local farmers in crop distribution, and, at the same time, promoting sustainable behavior among its employees with Libreng Gulay.</p>"
    },
    {
      img: "https://frontiertowersphilippines.com/wp-content/uploads/2025/08/5.png",
      alt: "Card 5",
      title: "Project Flip in Baguio in 2022",
      description: "<h2 style='color:#b30000;margin-bottom:10px;'>Project Flip in Baguio in 2022</h2><p>As part of our Annual Conference in 2022, we volunteered for an outreach program and tutoring services for the children of Bancua, Dontogan led by BFLI (Breakfast Feeding for Learning Inc.).</p>"
    },
    {
      img: "https://frontiertowersphilippines.com/wp-content/uploads/2025/08/6.png",
      alt: "Card 6",
      title: "Other Donations, Sponsorships, and Charitable Assistance",
      description: `
        <h2 style="color:#b30000; margin-bottom:10px;">
          Other Donations, Sponsorships, and Charitable Assistance
        </h2>
        <p>
          Frontier also made and will continue to provide support to community development initiatives, immediate disaster relief operations to areas in need and charitable assistance to its existing and future recipient organizations and communities.
        </p>
        <div style="display:flex; justify-content:center; gap:20px; flex-wrap:wrap; margin-top:15px;">
          <img src="https://frontiertowersphilippines.com/wp-content/uploads/2025/08/1-2.png" alt="Logo1" style="height:60px;">
          <img src="https://frontiertowersphilippines.com/wp-content/uploads/2025/08/2-1.png" alt="Logo2" style="height:60px;">
          <img src="https://frontiertowersphilippines.com/wp-content/uploads/2025/08/3-1.png" alt="Logo3" style="height:60px;">
          <img src="https://frontiertowersphilippines.com/wp-content/uploads/2025/08/4-1.png" alt="Logo4" style="height:60px;">
        </div>
      `
    }
  ];

  // ---- ELEMENTS ----
  const container = document.querySelector('.carousel-track-container');
  const track = document.querySelector('.carousel-track');
  const prevBtn = document.querySelector('.arrow-btn.prev');
  const nextBtn = document.querySelector('.arrow-btn.next');
  const descriptionBox = document.querySelector('.carousel-description');
  const carouselRoot = document.querySelector('.custom-carousel');

  if (!container || !track || !prevBtn || !nextBtn) {
    console.warn('Carousel: required elements missing.');
    return;
  }

  // ---- Modal (create if missing) ----
  let modal = document.getElementById('carousel-modal');
  if (!modal) {
    modal = document.createElement('div');
    modal.id = 'carousel-modal';
    modal.style.cssText = 'position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:9999;';
    modal.innerHTML = `
      <div role="dialog" aria-modal="true" style="max-width:820px;width:90%;background:#fff;border-radius:12px;padding:18px;position:relative;box-shadow:0 10px 40px rgba(0,0,0,.35);color:#111;">
        <button aria-label="Close" id="carousel-modal-close" style="position:absolute;right:14px;top:10px;border:none;background:transparent;font-size:20px;cursor:pointer">âœ•</button>
        <div id="carousel-modal-body" style="display:flex;gap:18px;align-items:flex-start;flex-wrap:wrap;">
          <img id="carousel-modal-img" src="" alt="" style="max-width:320px;width:100%;height:auto;border-radius:8px;object-fit:cover;">
          <div style="flex:1;min-width:220px">
            <h3 id="carousel-modal-title" style="margin:0 0 10px 0"></h3>
            <div id="carousel-modal-desc" style="color:#333;line-height:1.45"></div>
          </div>
        </div>
      </div>
    `;
    document.body.appendChild(modal);

    document.getElementById('carousel-modal-close').addEventListener('click', () => {
      modal.style.opacity = 0;
      setTimeout(() => modal.style.display = 'none', 200);
    });
    modal.addEventListener('click', (ev) => { if (ev.target === modal) { modal.style.opacity = 0; setTimeout(()=> modal.style.display='none',200); }});
    window.addEventListener('keydown', (ev) => { if (ev.key === 'Escape') { modal.style.opacity = 0; setTimeout(()=> modal.style.display='none',200); }});
  }

  function openModal(data) {
    if (!data) return;
    const img = document.getElementById('carousel-modal-img');
    const title = document.getElementById('carousel-modal-title');
    const desc = document.getElementById('carousel-modal-desc');

    img.src = data.img || '';
    img.alt = data.alt || '';
    title.textContent = data.title || '';
    // NOTE: innerHTML only set if description trusted
    desc.innerHTML = data.description || '';

    modal.style.display = 'flex';
    modal.style.opacity = 0;
    requestAnimationFrame(()=> modal.style.opacity = 1);
  }

  // ---- Carousel internals ----
  let slides = [];
  let currentIndex = 0;

  function clamp(n, a, b) { return Math.max(a, Math.min(b, n)); }

  function buildSlides(data) {
    const frag = document.createDocumentFragment();
    data.forEach(item => {
      const slide = document.createElement('div');
      slide.className = 'carousel-slide';
      slide.dataset.description = item.description ? String(item.description) : '';
      slide.dataset.img = item.img || '';
      slide.dataset.alt = item.alt || '';
      slide.dataset.title = item.title || '';

      const img = document.createElement('img');
      img.src = item.img || '';
      img.alt = item.alt || '';

      const p = document.createElement('p');
      p.textContent = (item.title || '').trim();
      if (!p.textContent) {
        p.classList.add('hidden');
        slide.classList.add('no-title');
      }

      slide.appendChild(img);
      slide.appendChild(p);
      frag.appendChild(slide);
    });

    track.innerHTML = '';
    track.appendChild(frag);
    slides = Array.from(track.querySelectorAll('.carousel-slide'));

    slides.forEach((s, idx) => {
      s.addEventListener('click', () => {
        if (isSlideCentered(s)) {
          openModal({
            img: s.dataset.img,
            alt: s.dataset.alt,
            title: s.dataset.title,
            description: s.dataset.description
          });
        } else {
          currentIndex = idx;
          centerActive();
        }
      });

      s.tabIndex = 0;
      s.addEventListener('keydown', (ev) => {
        if (ev.key === 'Enter' || ev.key === ' ') {
          ev.preventDefault();
          s.click();
        }
      });
    });
  }

  function centerActive() {
    if (!slides.length) return;

    slides.forEach(s => s.classList.remove('active'));
    const active = slides[currentIndex];
    if (!active) return;
    active.classList.add('active');

    const containerWidth = container.clientWidth;
    const trackWidth = track.scrollWidth;
    // center the active slide
    const targetCenter = active.offsetLeft + (active.offsetWidth / 2);
    let translate = (containerWidth / 2) - targetCenter;

    // clamp translate so no blank space is revealed
    const maxTranslate = 0;
    const minTranslate = Math.min(containerWidth - trackWidth, 0);
    translate = clamp(translate, minTranslate, maxTranslate);

    track.style.transform = `translateX(${translate}px)`;

    updateButtons();
    updateDescription();
  }

  function updateButtons() {
    prevBtn.disabled = currentIndex === 0;
    nextBtn.disabled = currentIndex === slides.length - 1;
  }

  function updateDescription() {
    if (!slides[currentIndex]) return;
    const desc = slides[currentIndex].dataset.description || '';
    if (desc.trim()) {
      descriptionBox.innerHTML = desc;
      descriptionBox.classList.remove('hidden');
    } else {
      descriptionBox.innerHTML = '';
      descriptionBox.classList.add('hidden');
    }
  }

  function isSlideCentered(slideEl) {
    if (!slideEl) return false;
    const containerRect = container.getBoundingClientRect();
    const slideRect = slideEl.getBoundingClientRect();
    const slideCenter = slideRect.left + (slideRect.width / 2);
    const containerCenter = containerRect.left + (containerRect.width / 2);
    // centered if distance < 40% of slide width (tweakable)
    return Math.abs(slideCenter - containerCenter) < (slideRect.width * 0.4);
  }

  // ---- Data loader ----
  async function loadData() {
    if (Array.isArray(window.CAROUSEL_DATA)) return window.CAROUSEL_DATA;
    try {
      const res = await fetch(DATA_URL, { cache: 'no-store' });
      if (!res.ok) throw new Error('Bad response');
      const json = await res.json();
      if (!Array.isArray(json)) throw new Error('JSON must be an array');
      return json;
    } catch (err) {
      console.warn('Carousel: falling back. Reason:', err);
      return FALLBACK.slice();
    }
  }

  // ---- Init ----
  const data = await loadData();
  buildSlides(data || []);
  currentIndex = clamp(INITIAL_INDEX, 0, Math.max(0, slides.length - 1));

  prevBtn.addEventListener('click', () => {
    if (currentIndex > 0) {
      currentIndex--;
      centerActive();
    }
  });
  nextBtn.addEventListener('click', () => {
    if (currentIndex < slides.length - 1) {
      currentIndex++;
      centerActive();
    }
  });

  prevBtn.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); prevBtn.click(); } });
  nextBtn.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); nextBtn.click(); } });

  window.addEventListener('resize', () => setTimeout(centerActive, 60));
  setTimeout(centerActive, 40);

  // ---- Drag support (basic) ----
  let isDown = false, startX = 0, startTranslate = 0;
  track.addEventListener('pointerdown', (ev) => {
    isDown = true;
    track.setPointerCapture(ev.pointerId);
    startX = ev.clientX;
    const m = getComputedStyle(track).transform.match(/matrix\\(([^)]+)\\)/);
    startTranslate = 0;
    if (m) {
      const vals = m[1].split(',').map(v => parseFloat(v.trim()));
      startTranslate = vals[4] || 0;
    }
    track.style.transition = 'none';
  }, { passive: true });

  track.addEventListener('pointermove', (ev) => {
    if (!isDown) return;
    const dx = ev.clientX - startX;
    const trackWidth = track.scrollWidth;
    const minTranslate = Math.min(container.clientWidth - trackWidth, 0);
    const maxTranslate = 0;
    let next = startTranslate + dx;
    next = clamp(next, minTranslate, maxTranslate);
    track.style.transform = `translateX(${next}px)`;
  }, { passive: true });

  const endDrag = (ev) => {
    if (!isDown) return;
    isDown = false;
    try { track.releasePointerCapture(ev && ev.pointerId); } catch (e) {}
    track.style.transition = '';
    // snap to nearest slide
    let bestIndex = 0, bestDist = Infinity;
    const containerRect = container.getBoundingClientRect();
    const containerCenterX = containerRect.left + (containerRect.width / 2);
    slides.forEach((s, i) => {
      const r = s.getBoundingClientRect();
      const sCenter = r.left + (r.width / 2);
      const d = Math.abs(sCenter - containerCenterX);
      if (d < bestDist) { bestDist = d; bestIndex = i; }
    });
    currentIndex = bestIndex;
    centerActive();
  };
  track.addEventListener('pointerup', endDrag);
  track.addEventListener('pointercancel', endDrag);
  track.addEventListener('pointerleave', endDrag);

  // ---- Mode helper ----
  window.setCarouselMode = function(mode) {
    if (!carouselRoot) return;
    if (mode === 'game') {
      carouselRoot.style.display = ''; // show
    } else {
      carouselRoot.style.display = 'none'; // hide for list or other modes
      descriptionBox.classList.add('hidden');
    }
  };

  // optionally set initial mode:
  // window.setCarouselMode('game');

}); // DOMContentLoaded
</script>

</body>
</html>
